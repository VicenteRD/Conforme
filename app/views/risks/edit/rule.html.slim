= render partial: 'referables/references_nav'

= form_for @risk, as: :risk, url: edit_risk_path(es_type(@risk.rule_type), @risk),
        method: :patch do |f|
  section.page-content
    .page-content-inner
      .panel style=('padding: 15px 25px')

        .row.form-group
          .col-lg-1.col-lg-offset-4.text-right
            = f.label :numeral, 'Numeral', class: 'form-control-label'
          .col-lg-3
            = f.text_field :numeral, class: 'form-control'

          .col-lg-1.text-right
            = f.label :title, 'TÃ­tulo', class: 'form-control-label'
          .col-lg-3
            = f.text_field :title, class: 'form-control'

        .row.form-group
          .col-lg-1.text-right
            = label :extra, :responsible_name, 'Responsable', class: 'form-control-label'
          #responsible-in.col-lg-3.input-group
            = text_field :extra, :responsible_name, class: 'form-control', readonly: true,
                    value: Person::User.find(@risk.responsible_id).first_last_name
            = f.hidden_field :responsible_id, class: 'form-control-hidden'
            span.input-group-addon style=('cursor: pointer')
              i.icmn-pencil5

          .col-lg-1.text-right
            = f.label :measurement_frequency, 'Frecuencia', class: 'form-control-label'
          .col-lg-3
            = f.collection_select :measurement_frequency, frequency_hash,
                    :first, :last, {}, {class: 'form-control', style: 'width:100%'}
      / .panel

      = render partial: 'shared/form/comments_area', locals: {form: f, key: :requirement}

      .row.is-flex
        .col-lg-5
          .panel style=('height: 100%')
            = render partial: 'uploaded_files/edit_attachments',
                     locals: {element: @risk, form: f}
        .col-lg-6.col-lg-offset-1
          .panel style=('height: 100%')
            = render partial: 'referables/show_all_for',
                     locals: {element: @risk, form_format: true}
  / section

  /! Confirmation modal
  = render partial: 'shared/form/confirmation_modal', locals: {form: f}


= content_for :scripts do
  javascript:
    #{}
    $(function (){
      setSelectedReferences(#{{ raw @risk.references.to_json }}, null);
    })

    $('#responsible-in').click(function () {
      setOptions('Person::User', 'Responsable', false, 'risk_responsible', $(this));
      renderAndShowReferencesModal();
    });
    #{}

= content_for :breadcrumbs do
  - rule = Rule.find(@risk.rule_id)

  .left
    ul.list-unstyled.breadcrumb.breadcrumb-custom
      li
        = rule_type_breadcrumb(@risk.rule_type)
      li
        = link_to rule.full_name, risks_path(rule)
      li
        = link_to "Art. #{@risk.numeral}", risk_path(es_type(@risk.rule_type), @risk)
      li
        span Editar
