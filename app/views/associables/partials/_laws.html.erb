<% picker_id = (@element.to_s.starts_with?('single') ? @element.to_s.split('_').to_a.last : nil) %>

<div class="row">
  <div class="table-responsive margin-bottom-30" style="height:300px; overflow:auto">
    <table class="table table-hover">
      <thead>
      <tr>
        <th>Ley</th>
        <th>Art√≠culo</th>
        <th>Requerimiento</th>
      </tr>
      </thead>
      <tbody>
      <% Law.each do |law| %>
          <% law.articles.each do |article| %>
              <tr class="<%= picker_id.nil? ? 'associable-data-row' : 'user-selectable' %>" data-law_id="<%= law.id %>" data-art_id="<%= article.id %>">
                <td id="law"><%= law.name %></td>
                <td id="article"><%= article.name %></td>
                <td><%= article.requirement %></td>
                <td><%= article.requirement %></td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
  </div>
</div>

<script>
    $('.user-selectable').click(function () {
        row = $(this);
        formGroup = $('#<%= picker_id %>');

        formGroup.find('.form-control')
            .val(row.find('#law').html() + ': ' + row.find('#article').html());

        formGroup.find('.law-input').val(row.attr('data-law_id'));
        formGroup.find('.article-input').val(row.attr('data-art_id'));


        $('#table-modal').modal('hide');
    });

    $('.associable-data-row').click(function () {
        row = $(this);
        container = $('#associables-container');

        selectedId = row.attr('data-id');

        selectedField = container.find('#' + selectedId);

        if (selectedField.length > 0) {
            selectedField.remove();
        } else {
            container.append(
                '<div id="' + selectedId + '">\n' +
                '  <input class="form-control-hidden" type="hidden" ' +
                'name="<%= @element %>[associables][laws][]" id="<%= @element %>_associable_law" ' +
                'value="' + selectedId + '">\n' +
                '  <input class="form-control user-displayed-name" readonly="readonly" type="text" ' +
                'name="associable_user_display" id="user_' + selectedId + '_display" ' +
                'value="Ley: ' + row.find('#law').html() + ': ' + row.find('#article').html() + '">\n' +
                '</div>'
            );
        }
    });

</script>
