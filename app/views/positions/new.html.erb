<%= form_for(:position, url: new_position_path) do |f| %>

    <section class="page-content">
      <div class="page-content-inner">

        <div class="panel padding-top-15">
          <%= render partial: 'referables/references_nav' %>

          <div class="row form-group margin-left-30 margin-right-20">
            <div class="col-lg-1">
              <label class="form-control-label">
                Padre
              </label>
            </div>
            <div class="col-lg-3 input-group margin-right-20" id="parent-in">
              <%= text_field :extra, :parent_name, class: 'form-control', readonly: true %>
              <span class="input-group-addon" style="cursor: pointer">
                <i class="icmn-pencil5"></i>
              </span>
              <%= f.hidden_field :parent_id, class: 'form-control-hidden' %>
            </div>
            <div class="col-lg-1">
              <label class="form-control-label">
                Nombre
              </label>
            </div>
            <div class="col-lg-3">
              <%= f.text_field :name, class: 'form-control' %>
            </div>
            <div class="col-lg-1">
              <label class="form-control-label">
                Área
              </label>
            </div>
            <div class="col-lg-1 padding-top-10">
              <%= f.check_box :area, class: 'form-control' %>
            </div>
          </div>

          <div class="row is-flex margin-30" style="height:50px">
            <div class="col-lg-2" style="text-align: center; vertical-align: middle">
              <h5 class="margin-0" style="height: 100%">
                <a class="category-trigger" href="javascript:openEmployeesModal()">
                  Personas
                </a>
              </h5>
            </div>
            <div class="col-lg-10" id="employees-in"></div>
          </div>

          <div class="row margin-left-30 margin-right-30">
            <div class="col-lg-6" id="competencies-in">
              <h6>
                <a href="javascript:openCompetenciesModal()">
                  Competencias
                </a>
              </h6>
            </div>
            <div class="col-lg-6" id="performances-in">
              <h6>
                <a href="javascript:openPerformancesModal()">
                  Desempeño Esperado
                </a>
              </h6>
            </div>
          </div>

          <div style="margin:50px 50px 0 50px">
            <%= f.file_field :attachments, class: 'dropify', multiple: true,
                             data: {height: '90px', width: '100%'} %>
          </div>

          <div class="row form-group" style="margin: 30px 10px;height:400px">
            <%= f.text_area :comments, class: 'form-control', data: {provider: 'summernote'} %>
          </div>

          <div id="references-container" style="margin: 0 30px 10px 30px">
            <h6>Referencias</h6>
          </div>

        </div>
      </div>
    </section>

    <!-- Confirmation modal -->
    <div id="confirmation-modal" class="modal fade modal-size-large" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content" id="confirmation-modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" id="confirmation-modal-title">Está Seguro?</h4>
          </div>

          <div class="modal-body" id="confirmation-modal-body">
            <%= text_area :log, :body, class: 'form-control height-150' %>
          </div>

          <div class="modal-footer">
            <div class="row">
              <div class="col-md-6 text-left">
                <button class="btn btn-danger width-150 height-50" data-dismiss="modal">Cancelar</button>
              </div>
              <div class="text-right col-md-6">
                <%= f.submit 'Ingresar', class: 'btn btn-primary width-150 height-50' %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

<% end %>

<%= content_for :scripts do %>
    <script>
        function employeeElementGenerator(target, klass, id, name) {
            target.append(
                '<div id="reference-' + id + '" style="display:inline">\n' +

                '<input class="form-control-hidden" type="hidden" ' +
                'name="position[user_ids][]" id="position_user_ids" ' +
                'value="' + id + '">\n' + (target.is(':empty') ? '' : ', ') + name +
                '</div>'
            );
        }

        function competencyElementGenerator(target, klass, id, name) {
            target.append(
                '<div id="reference-' + id + '">\n' +

                '<input class="form-control-hidden" type="hidden" ' +
                'name="position[competency_ids][]" id="position_competency_ids" ' +
                'value="' + id + '">\n' +

                '<input class="form-control" readonly="readonly" type="text" ' +
                'name="extra[competency_names][]" id="extra_competency_names" ' +
                'value="' + name + '">\n' +

                '</div>'
            );
        }
        function performanceElementGenerator(target, klass, id, name) {
            target.append(
                '<div id="reference-' + id + '">\n' +

                '<input class="form-control-hidden" type="hidden" ' +
                'name="position[performance_ids][]" id="position_performance_ids" ' +
                'value="' + id + '">\n' +

                '<input class="form-control" readonly="readonly" type="text" ' +
                'name="extra[performance_names][]" id="extra_performance_names" ' +
                'value="' + name + '">\n' +

                '</div>'
            );
        }

        function openEmployeesModal() {
            setOptions('Person::User', 'Personas', true, 'employees', $('#employees-in'));
            setElementGenerator(employeeElementGenerator);

            renderAndShowReferencesModal();
        }

        function openCompetenciesModal() {
            setOptions('Qualification', 'Competencias', true, 'type_competencies', $('#competencies-in'));
            setElementGenerator(competencyElementGenerator);

            renderAndShowReferencesModal('1');
        }

        function openPerformancesModal() {
            setOptions('Qualification', 'Desempeños', true, 'type_performances', $('#performances-in'));
            setElementGenerator(performanceElementGenerator);

            renderAndShowReferencesModal('2');
        }

        $('#parent-in').click(function () {
            setOptions('Position', 'Padre', false, 'parent_position', $(this));
            renderAndShowReferencesModal();
        });
    </script>
<% end %>

<%= content_for :styles do %>
    <style>
      .category-trigger {
        border-radius: 7px 0 0 7px;
        display: block;
        background-color: #01a8fb;
        height:100%;
        padding: 15px;
        color: #ffffff;
      }

      .category-trigger:hover, .category-trigger:focus {
        background-color: #1fb2fe;
        color: #ffffff;
      }

      #employees-in {
        background-color: #b0b0b0;
        color: #ffffff;
        border-radius: 0 7px 7px 0;
        height: 100%;
        display: inline;
        padding: 15px 0 0 10px;
      }
    </style>
<% end %>

<%= content_for :breadcrumbs do %>
    <div class="left">
      <ul class="list-unstyled breadcrumb breadcrumb-custom">
        <li>
          <%= link_to positions_path do %>
              Personas: Organigrama
          <% end %>
        </li>
        <li>
          <span>
            Nuevo
          </span>
        </li>
      </ul>
    </div>
<% end %>
