<%# Cheeky fix %>
<% presentable_type = @type.capitalize.sub('o', 'ó') %>

<%= form_for @job,
             as: :asset_job,
             url: edit_asset_job_path(job_type: @type, asset_id: @business_asset.id, id: @job.id),
             method: :patch do |f| %>

    <section class="page-content">
      <div class="page-content-inner">

        <div class="panel">

          <%= render partial: 'referables/references_nav' %>

          <div class="row form-group margin-left-15 margin-right-15">
            <div class="col-lg-1">
              <label class="form-control-label">
                Planificada
              </label>
            </div>
            <div class="col-lg-3">
              <div class='input-group date date-picker' id='date-picker'>
                <%= text_field :raw, :due_at, class: 'form-control',
                               data: {format: dt_form_format(true), max: 0},
                               value: @job.due_at.to_i %>
                <span class="input-group-addon">
                  <i class="icmn-calendar"></i>
                </span>
              </div>
            </div>
            <% if @type == 'mantencion' %>
                <div class="col-lg-1 text-right">
                  <label class="form-control-label">
                    Motivo
                  </label>
                </div>
                <div class="col-lg-3">
                  <%= f.text_field :motive, class: 'form-control' %>
                </div>

                <div class="col-lg-1 text-right">
                  <label class="form-control-label">
                    Resultado
                  </label>
                </div>
                <div class="col-lg-3">
                  <%= f.text_field :result, class: 'form-control' %>
                </div>
            <% end %>
          </div>

          <div class="row is-flex form-group margin-left-15">
            <div class="col-lg-1">
              <label class="form-control-label">
                Ejecutada
              </label>
            </div>

            <!--<div class="col-lg-1">
            </div>-->
            <div class="col-lg-3">
              <div class="row is-flex margin-0" style="height: 100%">
                <div class="col-sm-1" style="justify-content: center">
                  <%= check_box :raw, :executed, class: 'form-control' %>
                </div>
                <div class="col-sm-11">
                  <div class='input-group date date-picker'>
                    <%= text_field :raw, :executed_at, class: 'form-control',
                                   data: {format: dt_form_format(true)},
                                   value: DateTime.now.to_i,
                                   readonly: true %>
                    <span class="input-group-addon">
                      <i class="icmn-calendar"></i>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row form-group" style="margin: 30px 10px;height:400px">
            <%= f.text_area :comments, class: 'form-control', style: 'width:100%;height:300px', data: {provider: 'summernote'} %>
          </div>

          <div style="margin: 0 30px 10px 30px">
            <%= render partial: 'referables/show_all_for',
                       locals: {element: @job, form_format: true} %>
          </div>

        </div>

      </div>
    </section>


    <!-- Confirmation modal -->
    <div id="confirmation-modal" class="modal fade modal-size-large" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content" id="confirmation-modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" id="confirmation-modal-title">Está Seguro?</h4>
          </div>

          <div class="modal-body" id="confirmation-modal-body">
            <%= text_area :log, :body, class: 'form-control height-150' %>
          </div>

          <div class="modal-footer">
            <div class="row">
              <div class="col-md-6 text-left">
                <button class="btn btn-danger width-150 height-50" data-dismiss="modal">Cancelar</button>
              </div>
              <div class="text-right col-md-6">
                <%= f.submit 'Ingresar', class: 'btn btn-primary width-150 height-50' %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

<% end %>

<%= content_for :menu do %>
    <div class="dropdown">
      <% history_content = "#{escape_javascript(render partial: 'log/modal', locals: {book: @job.log_book})}" %>
      <a href="javascript:void(0)" class="dropdown-inline-button" onclick="showHistory('<%= history_content %>')">
        <i class="dropdown-inline-button-icon icmn-history"></i>
        Bitácora
      </a>
    </div>
<% end %>

<%= content_for :scripts do %>
    <script type="text/javascript">
        function showHistory(bodyContent) {
            $("#history-modal-body").html(bodyContent);
            $("#history-modal").modal();
        }

        $('#raw_executed').click(function () {
            var execAt = $('#raw_executed_at');
            if ($(this).is(':checked')) {
                execAt.removeAttr('readonly');
            } else {
                execAt.prop('readonly', 'readonly')
            }
        });
    </script>
<% end %>

<% content_for :breadcrumbs do %>
    <div class="left">
      <ul class="list-unstyled breadcrumb breadcrumb-custom">
        <li>
          <%= link_to business_assets_path do %>
              <%= presentable_type %> Activos
          <% end %>
        </li>
        <li>
          <%= link_to @business_asset.number, business_asset_path(@type, @business_asset) %>
        </li>
        <li>
          <span>
            Editar Trabajo
          </span>
        </li>
      </ul>
    </div>
<% end %>